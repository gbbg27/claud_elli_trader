<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Elliott Wave Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            color: white;
            padding: 40px;
            text-align: center;
            border-bottom: 5px solid #e94560;
        }
        
        .header h1 {
            font-size: 3.2em;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            letter-spacing: 2px;
        }
        
        .header .subtitle {
            font-size: 1.4em;
            opacity: 0.95;
            margin-bottom: 10px;
        }
        
        .input-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            color: white;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .input-group label {
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .input-group input,
        .input-group select {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            background: rgba(255,255,255,0.95);
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: 3px solid #ffc107;
        }
        
        .btn-analyze {
            background: linear-gradient(135deg, #e94560 0%, #d62839 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .btn-analyze:active {
            transform: translateY(0);
        }
        
        .btn-analyze:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #0f3460;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0f3460;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border: 2px solid #f5c6cb;
            display: none;
        }
        
        .error-message.active {
            display: block;
        }
        
        .info-message {
            background: #d1ecf1;
            color: #0c5460;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border: 2px solid #bee5eb;
            display: none;
        }
        
        .info-message.active {
            display: block;
        }
        
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 3px solid #dee2e6;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 4px solid #0f3460;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .stat-label {
            font-size: 0.95em;
            color: #6c757d;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #0f3460;
        }
        
        .stat-value.gain {
            color: #28a745;
        }
        
        .stat-value.loss {
            color: #dc3545;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1.8fr 1.2fr;
            gap: 30px;
            padding: 30px;
        }
        
        .chart-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #0f3460;
        }
        
        .chart-header h2 {
            color: #0f3460;
            font-size: 2em;
        }
        
        .degree-badge {
            background: linear-gradient(135deg, #e94560 0%, #d62839 100%);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .analysis-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .rules-box {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 25px;
        }
        
        .rules-box h3 {
            color: #155724;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .rule-item {
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .wave-structure {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .wave-structure h3 {
            color: #0f3460;
            margin-bottom: 20px;
            font-size: 1.5em;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .wave-item {
            padding: 18px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            border-radius: 10px;
            border-left: 5px solid #0f3460;
            transition: all 0.3s;
        }
        
        .wave-item:hover {
            transform: translateX(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .wave-item.impulse {
            border-left-color: #28a745;
        }
        
        .wave-item.correction {
            border-left-color: #dc3545;
        }
        
        .wave-item.current {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #fff 100%);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 3px solid #ffc107;
            padding: 25px;
            margin: 30px;
            border-radius: 12px;
            color: #856404;
        }
        
        .fib-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .fib-section h3 {
            margin-bottom: 20px;
            font-size: 1.6em;
        }
        
        .fib-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .fib-card {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .fib-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .fib-value {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .targets-section {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .targets-section h3 {
            margin-bottom: 20px;
            font-size: 1.6em;
        }
        
        .target-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .target-item strong {
            font-size: 1.2em;
        }
        
        .psychology-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .psychology-box h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .psych-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #fdcb6e;
        }
        
        .psych-label {
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 5px;
        }
        
        .psych-desc {
            font-size: 0.9em;
            color: #636e72;
            line-height: 1.5;
        }
        
        .guidelines-box {
            background: linear-gradient(135deg, #fab1a0 0%, #ff7675 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .guidelines-box h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .guideline-item {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 0.95em;
            line-height: 1.6;
            backdrop-filter: blur(10px);
        }
        
        .dual-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 0 30px 30px 30px;
        }
        
        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            margin: 20px 30px;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }
        
        .info-box h4 {
            color: #0d47a1;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            margin-left: 20px;
            color: #1565c0;
        }
        
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .dual-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .fib-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Universal Elliott Wave Analyzer</h1>
            <div class="subtitle">Professional Wave Analysis for Stocks, Crypto, Forex & Futures</div>
        </div>
        
        <div class="input-section">
            <div style="background: rgba(255,193,7,0.2); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                <strong>‚ö° Quick Start:</strong> Live data may be unavailable due to API restrictions. 
                Click the colored buttons below to instantly try sample data with full Elliott Wave analysis!
            </div>
            
            <div class="input-grid">
                <div class="input-group">
                    <label for="ticker">Ticker Symbol *</label>
                    <input type="text" id="ticker" placeholder="e.g., AAPL, BTC-USD, EURUSD" value="PLTR">
                </div>
                
                <div class="input-group">
                    <label for="assetType">Asset Type</label>
                    <select id="assetType">
                        <option value="stock">Stock</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="forex">Forex</option>
                        <option value="futures">Futures</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" value="2022-12-01">
                </div>
                
                <div class="input-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <div style="margin-bottom: 15px;">
                    <button class="btn-analyze" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); font-size: 1.3em; padding: 18px 50px;" onclick="useSampleData('PLTR')">
                        ‚ö° Try Live Demo (PLTR)
                    </button>
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn-analyze" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="useSampleData('PLTR')">
                        üìä PLTR Sample
                    </button>
                    <button class="btn-analyze" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" onclick="useSampleData('BTC-USD')">
                        ‚Çø BTC Sample
                    </button>
                    <button class="btn-analyze" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" onclick="useSampleData('AAPL')">
                        üçé AAPL Sample
                    </button>
                    <button class="btn-analyze" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" onclick="useSampleData('TSLA')">
                        üöó TSLA Sample
                    </button>
                </div>
                <div style="margin-top: 15px; opacity: 0.8;">
                    <small>Or enter a custom ticker and click Analyze (live data may fail due to CORS)</small>
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h4>üìå How This Works:</h4>
            <ul>
                <li><strong>üéØ Best Option:</strong> Click the big green "Try Live Demo" button above to instantly see PLTR Elliott Wave analysis</li>
                <li><strong>üìä Sample Data Available:</strong> PLTR, BTC-USD, AAPL, TSLA - Click the colored buttons for instant results</li>
                <li><strong>üåê Live Data:</strong> Enter any ticker and the app will TRY to fetch live data via CORS proxy</li>
                <li><strong>‚ö†Ô∏è Note:</strong> Live data often fails due to browser CORS restrictions. Sample data always works!</li>
                <li><strong>üí° Auto-Fallback:</strong> If live data fails, app automatically loads similar sample data</li>
            </ul>
            <div style="margin-top: 15px; padding: 10px; background: rgba(255,193,7,0.2); border-radius: 5px;">
                <strong>Recommended:</strong> Start with the sample data buttons to see full Elliott Wave analysis, then try custom tickers if needed.
            </div>
        </div>
        
        <div class="loading">
            <div class="spinner"></div>
            <p id="loadingText">Attempting to fetch live market data via CORS proxy...</p>
            <p style="font-size: 0.9em; opacity: 0.7; margin-top: 10px;">This may take 10-30 seconds or fail due to browser restrictions</p>
        </div>
        
        <div class="error-message">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>
        
        <div class="info-message">
            <strong>‚ÑπÔ∏è Info:</strong> <span id="infoText"></span>
        </div>
        
        <div class="results">
            <div class="stats-grid" id="statsGrid">
                <!-- Dynamic stats will be inserted here -->
            </div>
            
            <div class="main-content">
                <div class="chart-section">
                    <div class="chart-header">
                        <h2 id="chartTitle">Elliott Wave Structure</h2>
                        <span class="degree-badge" id="degreeBadge">INTERMEDIATE</span>
                    </div>
                    <canvas id="elliottChart"></canvas>
                </div>
                
                <div class="analysis-panel">
                    <div class="rules-box">
                        <h3>‚úì Elliott Wave Rules</h3>
                        <div id="rulesContent">
                            <!-- Dynamic rules verification -->
                        </div>
                    </div>
                    
                    <div class="wave-structure">
                        <h3>üåä Wave Analysis</h3>
                        <div id="waveContent">
                            <!-- Dynamic wave structure -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dual-grid">
                <div class="fib-section" id="fibSection">
                    <h3>üìê Fibonacci Retracements</h3>
                    <div class="fib-grid" id="fibGrid">
                        <!-- Dynamic Fibonacci levels -->
                    </div>
                    <div style="margin-top: 20px; font-size: 0.9em; opacity: 0.9;" id="fibNote">
                        <!-- Dynamic notes -->
                    </div>
                </div>
                
                <div class="targets-section" id="targetsSection">
                    <h3>üéØ Price Projections</h3>
                    <div id="targetsContent">
                        <!-- Dynamic targets -->
                    </div>
                </div>
            </div>
            
            <div class="dual-grid">
                <div class="psychology-box" id="psychologyBox">
                    <h3>üß† Elliott Wave Psychology</h3>
                    <div id="psychologyContent">
                        <!-- Dynamic psychology -->
                    </div>
                </div>
                
                <div class="guidelines-box" id="guidelinesBox">
                    <h3>üìã Key Guidelines Applied</h3>
                    <div id="guidelinesContent">
                        <!-- Dynamic guidelines -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Important Disclaimer:</strong>
            This Elliott Wave analysis tool is for educational purposes only. Wave counts are subjective interpretations and should not be considered financial advice. Multiple valid interpretations may exist. The market is not obligated to follow any pattern. Always conduct thorough research and consult with licensed financial advisors before making investment decisions. Past performance does not guarantee future results.
        </div>
    </div>
    
    <script>
        let chartInstance = null;
        
        // Set today's date as default end date
        document.getElementById('endDate').valueAsDate = new Date();
        
        function useSampleData(ticker) {
            document.getElementById('ticker').value = ticker;
            document.getElementById('startDate').value = ticker === 'PLTR' ? '2022-12-01' : '2023-01-01';
            document.getElementById('endDate').valueAsDate = new Date();
            analyzeSymbol();
        }
        
        async function analyzeSymbol() {
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            const assetType = document.getElementById('assetType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!ticker) {
                showError('Please enter a ticker symbol');
                return;
            }
            
            if (!startDate || !endDate) {
                showError('Please select both start and end dates');
                return;
            }
            
            // Hide previous results and errors
            document.querySelector('.results').classList.remove('active');
            document.querySelector('.error-message').classList.remove('active');
            document.querySelector('.info-message').classList.remove('active');
            document.querySelector('.loading').classList.add('active');
            
            try {
                // Fetch historical data
                const data = await fetchMarketData(ticker, startDate, endDate);
                
                if (!data || data.length === 0) {
                    throw new Error('No data received. Please check the ticker symbol and date range.');
                }
                
                // Analyze Elliott Waves
                const analysis = analyzeElliottWaves(data, ticker);
                
                // Display results
                displayResults(analysis, ticker, assetType);
                
                document.querySelector('.loading').classList.remove('active');
                document.querySelector('.results').classList.add('active');
                
            } catch (error) {
                console.error('Analysis error:', error);
                
                // Try to load sample data as fallback
                const sampleTicker = getSampleTicker(ticker);
                if (sampleTicker) {
                    showInfo(`Live data unavailable for ${ticker}. Loading ${sampleTicker} sample data instead to demonstrate the analysis...`);
                    
                    // Load sample data
                    setTimeout(() => {
                        document.getElementById('ticker').value = sampleTicker;
                        document.getElementById('startDate').value = sampleTicker === 'PLTR' ? '2022-12-01' : '2023-01-01';
                        analyzeSymbol();
                    }, 1000);
                } else {
                    showError(`Unable to fetch data for ${ticker}. Please try one of the sample data buttons below (PLTR, BTC-USD, AAPL, or TSLA) to see how the analysis works.`);
                    document.querySelector('.loading').classList.remove('active');
                }
            }
        }
        
        function getSampleTicker(requestedTicker) {
            // Map requested ticker to available sample data
            const samples = {
                'PLTR': 'PLTR',
                'BTC-USD': 'BTC-USD',
                'BTC': 'BTC-USD',
                'BITCOIN': 'BTC-USD',
                'AAPL': 'AAPL',
                'APPLE': 'AAPL',
                'TSLA': 'TSLA',
                'TESLA': 'TSLA'
            };
            
            // If exact match, return it
            if (samples[requestedTicker]) {
                return samples[requestedTicker];
            }
            
            // Default to PLTR as demo
            return 'PLTR';
        }
        
        async function fetchMarketData(ticker, startDate, endDate) {
            try {
                // Convert dates to timestamps
                const start = new Date(startDate).getTime() / 1000;
                const end = new Date(endDate).getTime() / 1000;
                
                // Try multiple methods
                
                // Method 1: CORS Proxy
                try {
                    updateLoadingText('Trying CORS proxy #1 (allorigins.win)...');
                    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?period1=${start}&period2=${end}&interval=1d`;
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(yahooUrl)}`;
                    
                    const response = await fetch(proxyUrl);
                    
                    if (response.ok) {
                        const json = await response.json();
                        
                        if (json.chart && json.chart.result && json.chart.result.length > 0) {
                            const result = json.chart.result[0];
                            const timestamps = result.timestamp;
                            const quotes = result.indicators.quote[0];
                            
                            const processedData = timestamps.map((timestamp, i) => ({
                                date: new Date(timestamp * 1000),
                                open: quotes.open[i],
                                high: quotes.high[i],
                                low: quotes.low[i],
                                close: quotes.close[i],
                                volume: quotes.volume[i]
                            })).filter(d => d.close !== null);
                            
                            if (processedData.length > 0) {
                                return processedData;
                            }
                        }
                    }
                } catch (e) {
                    console.log('CORS proxy #1 failed:', e.message);
                }
                
                // Method 2: Alternative proxy
                try {
                    updateLoadingText('Trying CORS proxy #2 (corsproxy.io)...');
                    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?period1=${start}&period2=${end}&interval=1d`;
                    const altProxy = `https://corsproxy.io/?${encodeURIComponent(yahooUrl)}`;
                    
                    const response = await fetch(altProxy);
                    
                    if (response.ok) {
                        const json = await response.json();
                        
                        if (json.chart && json.chart.result && json.chart.result.length > 0) {
                            const result = json.chart.result[0];
                            const timestamps = result.timestamp;
                            const quotes = result.indicators.quote[0];
                            
                            const processedData = timestamps.map((timestamp, i) => ({
                                date: new Date(timestamp * 1000),
                                open: quotes.open[i],
                                high: quotes.high[i],
                                low: quotes.low[i],
                                close: quotes.close[i],
                                volume: quotes.volume[i]
                            })).filter(d => d.close !== null);
                            
                            if (processedData.length > 0) {
                                return processedData;
                            }
                        }
                    }
                } catch (e) {
                    console.log('CORS proxy #2 failed:', e.message);
                }
                
                // Method 3: Use sample data for popular symbols
                updateLoadingText('Live data unavailable. Checking for sample data...');
                const sampleData = getSampleData(ticker, startDate, endDate);
                if (sampleData) {
                    showInfo(`Using sample data for ${ticker} (Live data unavailable due to CORS restrictions)`);
                    return sampleData;
                }
                
                throw new Error('Unable to fetch data. Try using sample data by clicking "Use Sample Data" button or enter data manually.');
                
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }
        
        function updateLoadingText(text) {
            const loadingEl = document.getElementById('loadingText');
            if (loadingEl) {
                loadingEl.textContent = text;
            }
        }
        
        function getSampleData(ticker, startDate, endDate) {
            // Sample data for demonstration
            const samples = {
                'PLTR': generatePLTRData(),
                'BTC-USD': generateBTCData(),
                'AAPL': generateAAPLData(),
                'TSLA': generateTSLAData(),
                'GLD': generateGLDData(),
                'SLV': generateSLVData(),
                'GDX': generateGDXData(),
                'NEM': generateNEMData(),
                'MP': generateMPData(),
                'SPY': generateSPYData(),
                'QQQ': generateQQQData(),
                'NVDA': generateNVDAData(),
                'BE': generateBEData()
            };
            
            if (samples[ticker]) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                return samples[ticker].filter(d => {
                    const date = new Date(d.date);
                    return date >= start && date <= end;
                });
            }
            
            return null;
        }
        
        function generatePLTRData() {
            // PLTR sample data from Dec 2022 to Nov 2025
            const baseData = [
                { date: '2022-12-01', close: 5.92 },
                { date: '2023-01-01', close: 7.5 },
                { date: '2023-02-01', close: 9.0 },
                { date: '2023-03-01', close: 11.0 },
                { date: '2023-04-01', close: 10.0 },
                { date: '2023-05-01', close: 16.0 },
                { date: '2023-06-01', close: 20.0 },
                { date: '2023-07-01', close: 28.0 },
                { date: '2023-08-01', close: 22.0 },
                { date: '2023-09-01', close: 18.0 },
                { date: '2023-10-01', close: 15.0 },
                { date: '2023-11-01', close: 18.0 },
                { date: '2023-12-01', close: 22.0 },
                { date: '2024-01-01', close: 25.0 },
                { date: '2024-02-01', close: 30.0 },
                { date: '2024-03-01', close: 35.0 },
                { date: '2024-04-01', close: 45.0 },
                { date: '2024-05-01', close: 55.0 },
                { date: '2024-06-01', close: 65.0 },
                { date: '2024-07-01', close: 78.0 },
                { date: '2024-08-01', close: 92.0 },
                { date: '2024-09-01', close: 115.0 },
                { date: '2024-10-01', close: 135.0 },
                { date: '2024-10-15', close: 155.0 },
                { date: '2024-11-01', close: 125.0 },
                { date: '2024-11-15', close: 145.0 },
                { date: '2024-12-01', close: 165.0 },
                { date: '2025-01-01', close: 175.0 },
                { date: '2025-02-01', close: 182.0 },
                { date: '2025-03-01', close: 188.0 },
                { date: '2025-04-01', close: 192.0 },
                { date: '2025-05-01', close: 195.0 },
                { date: '2025-06-01', close: 198.0 },
                { date: '2025-07-01', close: 200.0 },
                { date: '2025-08-01', close: 202.0 },
                { date: '2025-09-01', close: 205.0 },
                { date: '2025-10-01', close: 207.52 },
                { date: '2025-10-31', close: 207.52 },
                { date: '2025-11-07', close: 184.0 },
                { date: '2025-11-14', close: 174.46 }
            ];
            
            return baseData.map(d => ({
                date: new Date(d.date),
                open: d.close * 0.99,
                high: d.close * 1.02,
                low: d.close * 0.98,
                close: d.close,
                volume: 50000000
            }));
        }
        
        function generateBTCData() {
            // BTC-USD sample data
            const baseData = [
                { date: '2023-01-01', close: 16500 },
                { date: '2023-02-01', close: 23000 },
                { date: '2023-03-01', close: 28000 },
                { date: '2023-04-01', close: 29000 },
                { date: '2023-05-01', close: 27500 },
                { date: '2023-06-01', close: 30000 },
                { date: '2023-07-01', close: 29800 },
                { date: '2023-08-01', close: 26000 },
                { date: '2023-09-01', close: 27000 },
                { date: '2023-10-01', close: 34000 },
                { date: '2023-11-01', close: 37000 },
                { date: '2023-12-01', close: 42000 },
                { date: '2024-01-01', close: 43000 },
                { date: '2024-02-01', close: 52000 },
                { date: '2024-03-01', close: 71000 },
                { date: '2024-04-01', close: 64000 },
                { date: '2024-05-01', close: 67000 },
                { date: '2024-06-01', close: 61000 },
                { date: '2024-07-01', close: 66000 },
                { date: '2024-08-01', close: 59000 },
                { date: '2024-09-01', close: 63000 },
                { date: '2024-10-01', close: 68000 },
                { date: '2024-11-01', close: 89000 },
                { date: '2024-12-01', close: 95000 },
                { date: '2025-01-01', close: 102000 },
                { date: '2025-02-01', close: 98000 },
                { date: '2025-03-01', close: 85000 },
                { date: '2025-04-01', close: 88000 },
                { date: '2025-05-01', close: 92000 },
                { date: '2025-06-01', close: 94000 },
                { date: '2025-07-01', close: 97000 },
                { date: '2025-08-01', close: 101000 },
                { date: '2025-09-01', close: 105000 },
                { date: '2025-10-01', close: 108000 },
                { date: '2025-11-01', close: 103000 }
            ];
            
            return baseData.map(d => ({
                date: new Date(d.date),
                open: d.close * 0.98,
                high: d.close * 1.03,
                low: d.close * 0.97,
                close: d.close,
                volume: 25000000000
            }));
        }
        
        function generateAAPLData() {
            // AAPL sample data
            const baseData = [
                { date: '2023-01-01', close: 130 },
                { date: '2023-02-01', close: 147 },
                { date: '2023-03-01', close: 165 },
                { date: '2023-04-01', close: 169 },
                { date: '2023-05-01', close: 177 },
                { date: '2023-06-01', close: 193 },
                { date: '2023-07-01', close: 196 },
                { date: '2023-08-01', close: 187 },
                { date: '2023-09-01', close: 171 },
                { date: '2023-10-01', close: 170 },
                { date: '2023-11-01', close: 189 },
                { date: '2023-12-01', close: 193 },
                { date: '2024-01-01', close: 185 },
                { date: '2024-02-01', close: 182 },
                { date: '2024-03-01', close: 171 },
                { date: '2024-04-01', close: 169 },
                { date: '2024-05-01', close: 189 },
                { date: '2024-06-01', close: 214 },
                { date: '2024-07-01', close: 225 },
                { date: '2024-08-01', close: 226 },
                { date: '2024-09-01', close: 226 },
                { date: '2024-10-01', close: 230 },
                { date: '2024-11-01', close: 222 },
                { date: '2024-12-01', close: 247 },
                { date: '2025-01-01', close: 243 },
                { date: '2025-02-01', close: 238 },
                { date: '2025-03-01', close: 230 },
                { date: '2025-04-01', close: 212 },
                { date: '2025-05-01', close: 215 },
                { date: '2025-06-01', close: 226 },
                { date: '2025-07-01', close: 235 },
                { date: '2025-08-01', close: 228 },
                { date: '2025-09-01', close: 233 },
                { date: '2025-10-01', close: 240 },
                { date: '2025-11-01', close: 238 }
            ];
            
            return baseData.map(d => ({
                date: new Date(d.date),
                open: d.close * 0.99,
                high: d.close * 1.01,
                low: d.close * 0.99,
                close: d.close,
                volume: 60000000
            }));
        }
        
        function generateTSLAData() {
            // TSLA sample data
            const baseData = [
                { date: '2023-01-01', close: 123 },
                { date: '2023-02-01', close: 207 },
                { date: '2023-03-01', close: 207 },
                { date: '2023-04-01', close: 165 },
                { date: '2023-05-01', close: 203 },
                { date: '2023-06-01', close: 261 },
                { date: '2023-07-01', close: 291 },
                { date: '2023-08-01', close: 242 },
                { date: '2023-09-01', close: 250 },
                { date: '2023-10-01', close: 212 },
                { date: '2023-11-01', close: 234 },
                { date: '2023-12-01', close: 248 },
                { date: '2024-01-01', close: 188 },
                { date: '2024-02-01', close: 199 },
                { date: '2024-03-01', close: 175 },
                { date: '2024-04-01', close: 142 },
                { date: '2024-05-01', close: 178 },
                { date: '2024-06-01', close: 197 },
                { date: '2024-07-01', close: 246 },
                { date: '2024-08-01', close: 220 },
                { date: '2024-09-01', close: 250 },
                { date: '2024-10-01', close: 262 },
                { date: '2024-11-01', close: 338 },
                { date: '2024-12-01', close: 395 },
                { date: '2025-01-01', close: 412 },
                { date: '2025-02-01', close: 388 },
                { date: '2025-03-01', close: 363 },
                { date: '2025-04-01', close: 325 },
                { date: '2025-05-01', close: 318 },
                { date: '2025-06-01', close: 342 },
                { date: '2025-07-01', close: 356 },
                { date: '2025-08-01', close: 368 },
                { date: '2025-09-01', close: 385 },
                { date: '2025-10-01', close: 392 },
                { date: '2025-11-01', close: 378 }
            ];
            
            return baseData.map(d => ({
                date: new Date(d.date),
                open: d.close * 0.98,
                high: d.close * 1.04,
                low: d.close * 0.96,
                close: d.close,
                volume: 90000000
            }));
        }
        
        function analyzeElliottWaves(data, ticker) {
            // Find key pivot points using simple algorithm
            const closes = data.map(d => d.close);
            const dates = data.map(d => d.date);
            
            // Find absolute low and high
            const minPrice = Math.min(...closes);
            const maxPrice = Math.max(...closes);
            const minIdx = closes.indexOf(minPrice);
            const maxIdx = closes.indexOf(maxPrice);
            
            // Current price
            const currentPrice = closes[closes.length - 1];
            const currentDate = dates[dates.length - 1];
            
            // Calculate percentage changes
            const totalGain = ((maxPrice - minPrice) / minPrice * 100).toFixed(2);
            const currentChange = ((currentPrice - minPrice) / minPrice * 100).toFixed(2);
            const fromPeak = ((currentPrice - maxPrice) / maxPrice * 100).toFixed(2);
            
            // Identify waves using pivot points
            const waves = identifyWaves(data);
            
            // Calculate Fibonacci levels
            const fibLevels = calculateFibonacci(minPrice, maxPrice);
            
            // Verify Elliott Wave rules
            const rulesCheck = verifyElliottRules(waves);
            
            return {
                ticker,
                data,
                minPrice,
                maxPrice,
                currentPrice,
                minDate: dates[minIdx],
                maxDate: dates[maxIdx],
                currentDate,
                totalGain,
                currentChange,
                fromPeak,
                waves,
                fibLevels,
                rulesCheck
            };
        }
        
        function identifyWaves(data) {
            // Simplified wave identification using pivot detection
            const pivots = findPivots(data, 10); // 10-period lookback
            
            if (pivots.length < 5) {
                // Not enough pivots for full wave count
                return createSimpleWaveCount(data);
            }
            
            // Try to identify 5-wave structure from low to high
            const waves = [];
            const sortedPivots = [...pivots].sort((a, b) => a.index - b.index);
            
            // Find the major low (start of count)
            const startPivot = sortedPivots.find(p => p.type === 'low');
            
            if (!startPivot) return createSimpleWaveCount(data);
            
            // Build wave structure
            let currentType = 'impulse';
            for (let i = 0; i < Math.min(sortedPivots.length, 7); i++) {
                const pivot = sortedPivots[i];
                waves.push({
                    label: `Wave ${i + 1}`,
                    price: pivot.price,
                    date: pivot.date,
                    type: currentType,
                    index: pivot.index
                });
                currentType = currentType === 'impulse' ? 'correction' : 'impulse';
            }
            
            // Add current price as last point
            const lastData = data[data.length - 1];
            waves.push({
                label: 'Current',
                price: lastData.close,
                date: lastData.date,
                type: 'current',
                index: data.length - 1
            });
            
            return waves;
        }
        
        function findPivots(data, period) {
            const pivots = [];
            
            for (let i = period; i < data.length - period; i++) {
                const current = data[i].close;
                let isHigh = true;
                let isLow = true;
                
                // Check if it's a pivot high
                for (let j = i - period; j <= i + period; j++) {
                    if (j !== i && data[j].close >= current) {
                        isHigh = false;
                    }
                    if (j !== i && data[j].close <= current) {
                        isLow = false;
                    }
                }
                
                if (isHigh) {
                    pivots.push({
                        index: i,
                        price: current,
                        date: data[i].date,
                        type: 'high'
                    });
                } else if (isLow) {
                    pivots.push({
                        index: i,
                        price: current,
                        date: data[i].date,
                        type: 'low'
                    });
                }
            }
            
            return pivots;
        }
        
        function createSimpleWaveCount(data) {
            // Fallback: create simple 5-wave structure from min to max
            const closes = data.map(d => d.close);
            const minIdx = closes.indexOf(Math.min(...closes));
            const maxIdx = closes.indexOf(Math.max(...closes));
            
            const range = maxIdx - minIdx;
            const step = Math.floor(range / 5);
            
            const waves = [];
            for (let i = 0; i < 6; i++) {
                const idx = Math.min(minIdx + i * step, data.length - 1);
                waves.push({
                    label: i < 5 ? `Wave ${i + 1}` : 'Current',
                    price: data[idx].close,
                    date: data[idx].date,
                    type: i % 2 === 0 ? 'impulse' : 'correction',
                    index: idx
                });
            }
            
            return waves;
        }
        
        function calculateFibonacci(low, high) {
            const range = high - low;
            return {
                '0%': high,
                '23.6%': high - range * 0.236,
                '38.2%': high - range * 0.382,
                '50%': high - range * 0.5,
                '61.8%': high - range * 0.618,
                '78.6%': high - range * 0.786,
                '100%': low,
                // Extensions
                '161.8%': low + range * 1.618,
                '261.8%': low + range * 2.618
            };
        }
        
        function verifyElliottRules(waves) {
            if (waves.length < 5) return null;
            
            // Simplified rules check
            const wave1 = waves[0];
            const wave2 = waves[1];
            const wave3 = waves[2];
            const wave4 = waves[3];
            const wave5 = waves[4];
            
            const checks = {
                rule1: wave2.price > wave1.price * 0.5, // Wave 2 doesn't retrace more than 100%
                rule2: true, // Simplified - would need more complex calculation
                rule3: wave4.price > wave1.price, // Wave 4 doesn't overlap wave 1
                rule4: wave3.price > wave1.price // Wave 3 travels beyond wave 1
            };
            
            return checks;
        }
        
        function displayResults(analysis, ticker, assetType) {
            // Update stats
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Ticker</div>
                    <div class="stat-value">${ticker}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Cycle Start</div>
                    <div class="stat-value">$${analysis.minPrice.toFixed(2)}</div>
                    <div style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">${formatDate(analysis.minDate)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Peak Price</div>
                    <div class="stat-value gain">$${analysis.maxPrice.toFixed(2)}</div>
                    <div style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">${formatDate(analysis.maxDate)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Current Price</div>
                    <div class="stat-value">$${analysis.currentPrice.toFixed(2)}</div>
                    <div style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">${formatDate(analysis.currentDate)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Gain</div>
                    <div class="stat-value ${parseFloat(analysis.totalGain) >= 0 ? 'gain' : 'loss'}">
                        ${analysis.totalGain}%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">From Peak</div>
                    <div class="stat-value ${parseFloat(analysis.fromPeak) >= 0 ? 'gain' : 'loss'}">
                        ${analysis.fromPeak}%
                    </div>
                </div>
            `;
            document.getElementById('statsGrid').innerHTML = statsHTML;
            
            // Update chart
            document.getElementById('chartTitle').textContent = `${ticker} Elliott Wave Structure`;
            createChart(analysis);
            
            // Update rules
            if (analysis.rulesCheck) {
                const rulesHTML = `
                    <div class="rule-item">
                        <strong>Rule 1:</strong> Wave 2 retraces less than 100% of Wave 1
                        ${analysis.rulesCheck.rule1 ? ' ‚úì' : ' ‚úó'}
                    </div>
                    <div class="rule-item">
                        <strong>Rule 2:</strong> Wave 3 is never the shortest wave
                        ${analysis.rulesCheck.rule2 ? ' ‚úì' : ' ‚ö†'}
                    </div>
                    <div class="rule-item">
                        <strong>Rule 3:</strong> Wave 4 doesn't overlap Wave 1
                        ${analysis.rulesCheck.rule3 ? ' ‚úì' : ' ‚úó'}
                    </div>
                    <div class="rule-item">
                        <strong>Rule 4:</strong> Wave 3 travels beyond Wave 1
                        ${analysis.rulesCheck.rule4 ? ' ‚úì' : ' ‚úó'}
                    </div>
                `;
                document.getElementById('rulesContent').innerHTML = rulesHTML;
            }
            
            // Update waves
            const wavesHTML = analysis.waves.map(wave => `
                <div class="wave-item ${wave.type}">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: bold; font-size: 1.2em;">${wave.label}</span>
                        <span style="font-weight: bold; font-size: 1.1em; color: ${wave.type === 'correction' ? '#dc3545' : '#28a745'}">
                            $${wave.price.toFixed(2)}
                        </span>
                    </div>
                    <div style="font-size: 0.9em; color: #6c757d; margin-top: 5px;">
                        ${formatDate(wave.date)}
                    </div>
                </div>
            `).join('');
            document.getElementById('waveContent').innerHTML = wavesHTML;
            
            // Update Fibonacci levels
            const fibHTML = `
                <div class="fib-card">
                    <div class="fib-label">23.6% Fib</div>
                    <div class="fib-value">$${analysis.fibLevels['23.6%'].toFixed(2)}</div>
                </div>
                <div class="fib-card">
                    <div class="fib-label">38.2% Fib ‚≠ê</div>
                    <div class="fib-value">$${analysis.fibLevels['38.2%'].toFixed(2)}</div>
                </div>
                <div class="fib-card">
                    <div class="fib-label">50.0% Fib ‚≠ê</div>
                    <div class="fib-value">$${analysis.fibLevels['50%'].toFixed(2)}</div>
                </div>
                <div class="fib-card">
                    <div class="fib-label">61.8% Fib</div>
                    <div class="fib-value">$${analysis.fibLevels['61.8%'].toFixed(2)}</div>
                </div>
                <div class="fib-card">
                    <div class="fib-label">78.6% Fib</div>
                    <div class="fib-value">$${analysis.fibLevels['78.6%'].toFixed(2)}</div>
                </div>
                <div class="fib-card">
                    <div class="fib-label">100% (Low)</div>
                    <div class="fib-value">$${analysis.fibLevels['100%'].toFixed(2)}</div>
                </div>
            `;
            document.getElementById('fibGrid').innerHTML = fibHTML;
            
            const fibNoteHTML = `
                <strong>Most Likely Target:</strong> $${analysis.fibLevels['38.2%'].toFixed(2)} - $${analysis.fibLevels['50%'].toFixed(2)} range (38.2%-50% zone)<br>
                <strong>Current Price vs Fib:</strong> ${getCurrentFibLevel(analysis)}
            `;
            document.getElementById('fibNote').innerHTML = fibNoteHTML;
            
            // Update price projections
            const range = analysis.maxPrice - analysis.minPrice;
            const wave1Estimate = range * 0.3; // Estimate wave 1 as 30% of range
            
            const targetsHTML = `
                <div class="target-item">
                    <span>Conservative (0.618 ext)</span>
                    <strong>$${(analysis.minPrice + range * 1.618).toFixed(2)}</strong>
                </div>
                <div class="target-item">
                    <span>Standard (1.00 ext)</span>
                    <strong>$${(analysis.minPrice + range * 2.0).toFixed(2)}</strong>
                </div>
                <div class="target-item">
                    <span>Extended (1.618 ext)</span>
                    <strong>$${(analysis.minPrice + range * 2.618).toFixed(2)}</strong>
                </div>
                <div class="target-item">
                    <span>Maximum Extension</span>
                    <strong>$${(analysis.minPrice + range * 3.0).toFixed(2)}</strong>
                </div>
                <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.95;">
                    <strong>Note:</strong> Projections based on completed wave structure and Fibonacci extensions from cycle low ($${analysis.minPrice.toFixed(2)})
                </div>
            `;
            document.getElementById('targetsContent').innerHTML = targetsHTML;
            
            // Update psychology
            const psychologyHTML = `
                <div class="psych-item">
                    <div class="psych-label">Wave 1: Recognition Phase</div>
                    <div class="psych-desc">Early recovery from bottom. Smart money accumulating. Most investors still skeptical or unaware.</div>
                </div>
                <div class="psych-item">
                    <div class="psych-label">Wave 2: "Test of Lows"</div>
                    <div class="psych-desc">Shake out of weak hands. Fear returns but doesn't make new low. Building foundation.</div>
                </div>
                <div class="psych-item">
                    <div class="psych-label">Wave 3: "Powerful Wave"</div>
                    <div class="psych-desc">Broad recognition. Strongest momentum. Media attention increases. Trend followers join.</div>
                </div>
                <div class="psych-item">
                    <div class="psych-label">Wave 4: "Surprising Disappointment"</div>
                    <div class="psych-desc">Profit-taking despite good news. Consolidation phase. Strong hands accumulate from weak hands.</div>
                </div>
                <div class="psych-item">
                    <div class="psych-label">Wave 5: "Final Advance"</div>
                    <div class="psych-desc">Broad participation. Retail FOMO. Overvaluation concerns. Divergences appear. Prepare for correction.</div>
                </div>
            `;
            document.getElementById('psychologyContent').innerHTML = psychologyHTML;
            
            // Update guidelines
            const guidelinesHTML = `
                <div class="guideline-item">
                    <strong>Alternation:</strong> If Wave 2 is sharp, Wave 4 should be sideways (flat/triangle), and vice versa
                </div>
                <div class="guideline-item">
                    <strong>Extension:</strong> One of waves 1, 3, or 5 extends. Most commonly Wave 3 extends in strong trends
                </div>
                <div class="guideline-item">
                    <strong>Equality:</strong> When Wave 3 extends, Waves 1 and 5 tend toward equality in time and magnitude
                </div>
                <div class="guideline-item">
                    <strong>Depth of Wave 4:</strong> Often retraces into Wave 4 territory of one lesser degree
                </div>
                <div class="guideline-item">
                    <strong>Channeling:</strong> Impulse waves often travel within parallel trend channels
                </div>
                <div class="guideline-item">
                    <strong>Fibonacci Ratios:</strong> Wave relationships often exhibit 0.618, 1.00, or 1.618 ratios
                </div>
                <div class="guideline-item">
                    <strong>Volume:</strong> Wave 3 typically shows strongest volume. Wave 5 may show declining volume (bearish divergence)
                </div>
            `;
            document.getElementById('guidelinesContent').innerHTML = guidelinesHTML;
        }
        
        function getCurrentFibLevel(analysis) {
            const currentPrice = analysis.currentPrice;
            const fibs = analysis.fibLevels;
            
            if (currentPrice >= fibs['0%']) return 'Above all-time high';
            if (currentPrice >= fibs['23.6%']) return 'Between 0% and 23.6% retracement';
            if (currentPrice >= fibs['38.2%']) return 'Between 23.6% and 38.2% retracement';
            if (currentPrice >= fibs['50%']) return 'Between 38.2% and 50% retracement';
            if (currentPrice >= fibs['61.8%']) return 'Between 50% and 61.8% retracement';
            if (currentPrice >= fibs['78.6%']) return 'Between 61.8% and 78.6% retracement';
            return 'Below 78.6% retracement';
        }
        
        function createChart(analysis) {
            const ctx = document.getElementById('elliottChart').getContext('2d');
            
            // Destroy previous chart if exists
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            // Prepare data - sample every nth point if too many
            let chartData = analysis.data;
            if (chartData.length > 200) {
                const step = Math.ceil(chartData.length / 200);
                chartData = chartData.filter((_, i) => i % step === 0);
            }
            
            // Add wave markers
            const wavePoints = analysis.waves.map(w => ({
                x: formatDate(w.date),
                y: w.price
            }));
            
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(15, 52, 96, 0.6)');
            gradient.addColorStop(1, 'rgba(15, 52, 96, 0.0)');
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => formatDate(d.date)),
                    datasets: [{
                        label: 'Price',
                        data: chartData.map(d => d.close),
                        borderColor: '#0f3460',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 15
                            }
                        }
                    }
                }
            });
        }
        
        function formatDate(date) {
            const d = new Date(date);
            const month = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][d.getMonth()];
            return `${month} ${d.getDate()}, ${d.getFullYear()}`;
        }
        
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.querySelector('.error-message').classList.add('active');
            document.querySelector('.info-message').classList.remove('active');
        }
        
        function showInfo(message) {
            document.getElementById('infoText').textContent = message;
            document.querySelector('.info-message').classList.add('active');
            document.querySelector('.error-message').classList.remove('active');
        }
        
        // Allow Enter key to trigger analysis
        document.getElementById('ticker').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeSymbol();
            }
        });
    </script>
</body>
</html>